---
global:
  resolve_timeout: 5m
route:
  group_by: ["alertname", "job"]
  group_interval: 10m
  group_wait: 1m
  receiver: telegram
  repeat_interval: 12h
  routes:
    - receiver: "null"
      matchers:
        - alertname =~ "InfoInhibitor|Watchdog"
      continue: false
    - receiver: telegram
      continue: true
      matchers:
        - severity = "critical"
inhibit_rules:
  - equal: ["alertname", "namespace"]
    source_matchers:
      - severity = "critical"
    target_matchers:
      - severity = "warning"
receivers:
  - name: "null"
  - name: telegram
    telegram_configs:
      - send_resolved: true
        chat_id: {{ .TELEGRAM_CHAT_ID }}
        bot_token: {{ .TELEGRAM_BOT_TOKEN }}
        parse_mode: "Markdown"
        message: >-
          {{ "{{" }} define "__alert_severity_prefix_title" {{ "-}}" }}
            {{ "{{-" }} if eq .Status "firing" {{ "-}}" }}
              {{ "{{" }} if eq .CommonLabels.severity "info" {{ "-}}" }}
                ‚ÑπÔ∏è
              {{ "{{" }} else if eq .CommonLabels.severity "warning" {{ "-}}" }}
                ‚ö†Ô∏è
              {{ "{{" }} else if eq .CommonLabels.severity "critical" {{ "-}}" }}
                üî¥
              {{ "{{" }} else {{ "-}}" }}
                üî¥
              {{ "{{-" }} end {{ "-}}" }}
            {{ "{{" }} else {{ "-}}" }}
            ‚úÖ
            {{ "{{-" }} end {{ "}}" }}
          {{ "{{-" }} end {{ "}}" }}

          {{ "{{" }} define "__alert_severity_title" {{ "-}}" }}
            **{{ "{{-" }} .Status | toUpper {{ "-}}" }}
            {{ "{{" }} if eq .Status "firing" {{ "}}" }}:{{ "{{" }} .Alerts.Firing | len {{ "}}" }}{{ "{{-" }} end {{ "}}" }}
            {{ "{{" }} template "__alert_severity_prefix_title" . {{ "}}" }} {{ "{{" }} .CommonLabels.alertname {{ "}}" }}**
          {{ "{{-" }} end {{ "}}" }}
          {{ "{{" }} define "__alert_severity_text" {{ "-}}" }}
            {{ "{{-" }} $alertsLen := (len .Alerts) {{ "-}}" }}
            {{ "{{" }} range $index, $alert := .Alerts {{ "}}" }}
              {{ "{{-" }} if le $index 5 {{ "}}" }}
                {{ "{{-" }} if $alert.Annotations.summary {{ "}}" }}
                  *{{ "{{" }} $alert.Annotations.summary {{ "}}" }}*
                {{ "{{-" }} end {{ "}}" }}
                {{ "{{-" }} if $alert.Annotations.description {{ "}}" }}
                  *{{ "{{" }} $alert.Annotations.description {{ "}}" }}*
                {{ "{{-" }} end {{ "}}" }}
                {{ "{{-" }} if le $alertsLen 3 {{ "}}" }}
                  [Prometheus Link]({{ "{{" }} $alert.GeneratorURL {{ "}}" }})
                {{ "{{-" }} end {{ "}}" }}
              {{ "{{-" }} else if eq $index 5 {{ "}}" }}
                *... and {{ "{{" }} sub $alertsLen 5 {{ "}}" }} more alerts*
              {{ "{{-" }} end {{ "}}" }}
            {{ "{{" }} end {{ "}}" }}
          {{ "{{-" }} end {{ "}}" }}

          {{ "{{" }} template "__alert_severity_title" . {{ "}}" }}
          {{ "{{" }} template "__alert_severity_text" . {{ "}}" }}
