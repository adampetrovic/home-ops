---
name: Test Runner

on:
  workflow_dispatch:

jobs:
  test-runner:
    name: Test Self-Hosted Runner
    runs-on: home-ops-runner
    steps:
      - name: Check runner environment
        run: |
          echo "Running on: $(hostname)"
          echo "User: $(whoami)"
          echo "Working directory: $(pwd)"
          
      - name: Verify Talos config mount
        run: |
          echo "Checking for Talos config..."
          ls -la /var/run/secrets/talos.dev/
          
      - name: Install talosctl
        run: |
          curl -fsSL https://raw.githubusercontent.com/siderolabs/talos/main/website/static/install | sh
          
      - name: Test talosctl with mounted config
        run: |
          export TALOSCONFIG=/var/run/secrets/talos.dev/config
          echo "Testing talosctl connection to nodes..."
          talosctl --nodes 10.0.80.10 version
          
      - name: Test kubectl access
        run: |
          echo "Testing kubectl access..."
          kubectl get nodes
          kubectl get pods -n actions-runner-system
